%% Initialization
clear;close all;clc;tic;

ALL_HOR{1} = {[5],[1,1],[2,2],[13],[1,1],[1,2,2,1],[2,1,1,2],[5,5],[2,7,2],[1,2,2,1],[1,1],[1,1],[2,2],[1,1,1,1],[13]};
ALL_VERT{1} = {[10],[1,3,1,1],[1,1,1,1,2],[2,1,1,1,1],[3,3,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[3,3,1],[2,1,1,1,1],[1,1,1,1,2],[1,3,1,1],[10]};
ALL_M_sol{1} = [ -1 -1 -1 -1 -1  1  1  1  1  1 -1 -1 -1 -1 -1;
                 -1 -1 -1 -1  1 -1 -1 -1 -1 -1  1 -1 -1 -1 -1;
                 -1 -1 -1  1  1 -1 -1 -1 -1 -1  1  1 -1 -1 -1;
                 -1  1  1  1  1  1  1  1  1  1  1  1  1  1 -1;
                  1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1  1;
                  1 -1  1  1 -1 -1 -1 -1 -1 -1 -1  1  1 -1  1;
                  1  1 -1 -1  1 -1 -1 -1 -1 -1  1 -1 -1  1  1;
                  1  1  1  1  1 -1 -1 -1 -1 -1  1  1  1  1  1;
                  1  1 -1 -1  1  1  1  1  1  1  1 -1 -1  1  1;
                  1 -1  1  1 -1 -1 -1 -1 -1 -1 -1  1  1 -1  1;
                  1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1  1;
                  1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1  1;
                  1  1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1  1  1;
                  1 -1  1 -1 -1 -1 -1 -1 -1 -1 -1 -1  1 -1  1;
                 -1  1  1  1  1  1  1  1  1  1  1  1  1  1 -1];
      
ALL_HOR{2} = {[11],[1,1,1],[1,1,1],[1,1,1],[14],[15],[15],[15],[1,5,1],[3,1,1,3],[5,3,5],[2,2,2,2],[5,5],[3,3],[]};
ALL_VERT{2} = {[4,3],[4,5],[4,2,2],[4,5],[8,3],[1,6],[1,5,1],[1,5,1],[9,1],[1,6],[1,4,3],[1,4,5],[1,4,2,2],[1,4,5],[9,3]};
ALL_M_sol{2} = [ -1 -1 -1 -1  1  1  1  1  1  1  1  1  1  1  1;
                 -1 -1 -1 -1  1 -1 -1 -1 -1  1 -1 -1 -1 -1  1;
                 -1 -1 -1 -1  1 -1 -1 -1 -1  1 -1 -1 -1 -1  1;
                 -1 -1 -1 -1  1 -1 -1 -1 -1  1 -1 -1 -1 -1  1;
                 -1  1  1  1  1  1  1  1  1  1  1  1  1  1  1;
                  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1;
                  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1;
                  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1;
                  1 -1 -1 -1 -1  1  1  1  1  1 -1 -1 -1 -1  1;
                 -1  1  1  1 -1  1 -1 -1 -1  1 -1  1  1  1 -1;
                  1  1  1  1  1 -1  1  1  1 -1  1  1  1  1  1;
                  1  1 -1  1  1 -1 -1 -1 -1 -1  1  1 -1  1  1;
                  1  1  1  1  1 -1 -1 -1 -1 -1  1  1  1  1  1;
                 -1  1  1  1 -1 -1 -1 -1 -1 -1 -1  1  1  1 -1;
                 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1];
                 
ALL_HOR{3} = {[3],[3,2],[1,2,3],[8],[3],[5,2],[2,3],[8],[2,2,2],[3,1],[3,4],[2,1,3],[1,2],[2,3],[6]};
ALL_VERT{3} = {[1],[1],[1,1],[3],[1,2,2],[1,1,1],[1,1,1,2,1],[2,5,1],[3,1,1,2,2],[1,3,1,6],[5,2,4],[10],[2,2],[1,4],[1,2]};
ALL_M_sol{3} = [  1  1  1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1;
                 -1 -1 -1 -1 -1 -1 -1 -1  1  1  1 -1  1  1 -1;
                 -1 -1  1 -1 -1 -1 -1  1  1 -1  1  1  1 -1 -1;
                 -1 -1 -1 -1  1  1  1  1  1  1  1  1 -1 -1 -1;
                 -1 -1 -1 -1 -1 -1 -1 -1 -1  1  1  1 -1 -1 -1;
                 -1 -1 -1 -1 -1 -1 -1  1  1  1  1  1 -1  1  1;
                 -1 -1 -1 -1 -1 -1  1  1 -1 -1 -1  1  1  1 -1;
                 -1 -1 -1 -1 -1 -1 -1  1  1  1  1  1  1  1  1;
                 -1 -1 -1 -1 -1 -1  1  1 -1 -1  1  1 -1  1  1;
                 -1 -1 -1 -1 -1 -1 -1  1  1  1 -1  1 -1 -1 -1;
                 -1 -1 -1 -1  1  1  1 -1  1  1  1  1 -1 -1 -1;
                 -1 -1 -1  1  1 -1  1 -1 -1  1  1  1 -1 -1 -1;
                 -1 -1 -1  1 -1 -1 -1 -1 -1  1  1 -1 -1 -1 -1;
                 -1 -1 -1  1  1 -1 -1 -1  1  1  1 -1 -1 -1 -1;
                 -1 -1 -1 -1  1  1  1  1  1  1 -1 -1 -1 -1 -1];

for k = [1,2,3]
    VERT = ALL_VERT{k};
    HOR = ALL_HOR{k};
    M_sol = ALL_M_sol{k};
    
    M = zeros(15);
    % Zero - no idea
    % One  - hit
    % -One - empty

    spd = 0;

    pause(spd)

    %% Start solving
    M_last = [];
    while ~isequal(M, M_last)
        M_last = M;
        %% Rows
        for i = 1:size(M,1)
            M(i,:) = przeanalizuj5(M(i,:),HOR{i});
        end

        %% Columns
        for i = 1:size(M,2)
            M(:,i) = przeanalizuj5(M(:,i)',VERT{i})';
        end
    end

    subplot(2,3,k)
    visualize(M,VERT,HOR,0);
    subplot(2,3,k+3)
    visualize(M_sol,VERT,HOR,0);
    
end